env: "mn5"

data:
  dataset_path: data/processed/real_with_id.zarr
  region2vec_path: configs/outputs/region_embeddings/region_embeddings.pt
  use_valid_targets: true
  mobility_threshold: 10
  missing_permit: 2
  window_stride: 1
  sample_ordering: "time"
  log_scale: true
model:
  type:
    cases: true
    regions: true
    biomarkers: true
    mobility: true
  params:
    mobility_embedding_dim: 32
    region_embedding_dim: 64
    gnn_module: "gcn"
    #-- seq sizes --#
    history_length: 28
    forecast_horizon: 7
    #-- graph params --#
    max_neighbors: 20
    gnn_depth: 2
output:
  experiment_name: mn5_epiforecaster_temporal
  log_dir: outputs/training
  wandb_mode: offline
  wandb_tags: [mn5]
training:
  device: "cuda"
  batch_size: 16
  gradient_accumulation_steps: 4
  early_stopping_patience: 5
  nan_loss_patience: 5
  epochs: 10
  learning_rate: 0.001
  weight_decay: 1.0e-05
  num_workers: 16
  val_workers: 2
  prefetch_factor: 4
  pin_memory: true

  # Temporal split configuration
  split_strategy: "time"
  train_end_date: "2021-01-31"
  val_end_date: "2021-03-31"
  # test_end_date omitted - uses all remaining data

  # ignored
  val_split: 0.1
  test_split: 0.1

  profiler:
    enabled: true
    profile_batches: 20
    log_dir: auto
  plot_forecasts: true
  num_forecast_samples: 3
  # Joint inference loss configuration
  loss:
    name: "joint_inference"
    joint:
      w_ww: 1.0
      w_hosp: 1.0
      w_cases: 1.0
      w_deaths: 1.0
      w_sir: 0.1
