# Preprocessing configuration for synthetic epidemiological data

env: "mn5"
#
# WARNING: DO NOT RUN THIS CONFIG LOCALLY. This config is designed for MN5-scale
# synthetic data processing and requires significant memory and compute resources.
# Running locally may crash your machine due to memory constraints (OOM).
#
# Synthetic data is generated by EpiSim.jl and bundled in a single zarr file
# with all variables. Use SyntheticProcessor to extract components.
#
# Key difference from real data: synthetic uses concentration mode because
# it contains pre-computed concentrations without flow_rate information.

# All synthetic data comes from the single bundled zarr
data_dir: "data/files"
synthetic_path: "data/files/raw_synthetic_observations.zarr"
# Individual paths are not used when synthetic_path is set, but required by config
cases_file: "data/files/raw_synthetic_observations.zarr"
mobility_path: "data/files/raw_synthetic_observations.zarr"
wastewater_file: "data/files/raw_synthetic_observations.zarr"
population_file: "data/files/raw_synthetic_observations.zarr"
region_metadata_file: "data/files/edar_muni_edges.nc"

# Optional: Hospitalizations and deaths data (also from synthetic zarr if available)
# When synthetic_path is set, these are extracted from the same zarr bundle
# Leave commented out to auto-detect from synthetic data
# hospitalizations_file: "data/files/raw_synthetic_observations.zarr"
# deaths_file: "data/files/raw_synthetic_observations.zarr"

# Temporal processing parameters - match synthetic data range
start_date: "2020-02-09"
end_date: "2020-06-01"

# Feature processing options
# IMPORTANT: Synthetic data MUST use concentration mode
wastewater_flow_mode: "concentration"

# Region filtering
min_density_threshold: 0.01  # Low threshold for synthetic data

# Output configuration
output_path: "data/processed"
dataset_name: "synthetic_full"
compression: "blosc"

# Alignment and validation options
alignment_strategy: "interpolate"
target_dataset: "cases"
crop_datasets: true
validate_alignment: true
generate_alignment_report: true

# Processing configuration
num_workers: 8
chunk_size: 365
run_id_chunk_size: 1
date_chunk_size: 30   # Chunk size for date dimension in zarr output
mobility_chunk_size: 100  # Chunk size for spatial dims (origin/destination)
memory_limit_gb: 100.0

# Graph construction options
graph_options:
  edge_strategy: "knn"
  k_neighbors: 8
  distance_threshold: 50.0
  include_self_loops: false

# Validation and quality control options
validation_options:
  max_missing_percentage: 0.5  # Higher tolerance for synthetic
  min_data_coverage: 0.5
  outlier_detection: false  # Synthetic data is clean
  outlier_threshold: 3.0
  temporal_consistency_check: true
  spatial_consistency_check: true
  generate_plots: false
