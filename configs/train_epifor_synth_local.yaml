# CAUTION: Local test config for synthetic data training
#
# This is a MINIMAL config for testing gradient accumulation on a local machine.
# Uses very conservative settings to avoid OOM:
# - Tiny micro-batch (2 samples)
# - Minimal workers (no multiprocessing)
# - Profiling disabled
# - run_id_chunk_size: 1 for memory-efficient loading

data:
    dataset_path: data/processed/synthetic_full.zarr
    region2vec_path: checkpoints/region_embedding/region_embeddings.pt
    use_valid_targets: false  # Reduces dataset size
    mobility_threshold: 10
    missing_permit: 2
    window_stride: 1
    sample_ordering: "time"
    log_scale: true
    run_id: "0_Baseline"
    run_id_chunk_size: 1  # Load data in small chunks for memory safety

model:
    type:
        cases: true
        regions: true
        biomarkers: true
        mobility: true
    params:
        mobility_embedding_dim: 32
        region_embedding_dim: 64
        gnn_module: "gcn"
        history_length: 21
        forecast_horizon: 7
        max_neighbors: 20
        gnn_depth: 2

output:
    experiment_name: synth_local_test
    log_dir: outputs/training

training:
    device: "auto"  # Will use CPU if no GPU available
    batch_size: 2  # Tiny micro-batch for local testing
    gradient_accumulation_steps: 2  # Effective batch = 4
    early_stopping_patience: 3
    nan_loss_patience: 3
    epochs: 2  # Quick test - just 2 epochs
    learning_rate: 0.001
    weight_decay: 1.0e-05
    num_workers: 0  # No multiprocessing for simplicity
    val_workers: 0
    prefetch_factor: null

    # Use node split (smaller effective dataset than time split for synthetic)
    split_strategy: "node"

    val_split: 0.1
    test_split: 0.1

    profiler:
        enabled: false  # Disable profiling for local test
    plot_forecasts: false  # Disable plotting for faster test
    enable_mixed_precision: false  # Disable for CPU compatibility
